<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Snack Inventory System</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; padding:20px; }
    h1 { text-align:center; }
    table { width:100%; border-collapse: collapse; margin-top:20px; background:#fff; }
    th, td { border:1px solid #ccc; padding:10px; text-align:center; }
    th { background:#222; color:#fff; }
    input { width:90px; padding:5px; }
    button { padding:10px 20px; cursor:pointer; font-size:16px; }
    .log { margin-top:30px; background:#fff; padding:15px; }
    .sell-btn { margin-top:20px; text-align:center; }
  </style>
</head>
<body>

<!-- üîê LOGIN -->
<div id="loginBox" style="max-width:300px;margin:100px auto;text-align:center;background:#fff;padding:20px;border-radius:8px;">
  <h2>üîê Enter Password</h2>
  <input type="password" id="passwordInput" placeholder="Password" style="padding:10px;width:100%;margin-bottom:10px;">
  <button onclick="checkPassword()">Login</button>
  <p id="error" style="color:red;"></p>
</div>

<!-- üõí MAIN APP -->
<div id="app" style="display:none;">

<h1>üõí Snack Inventory & Sales</h1>

<table id="inventoryTable">
  <thead>
    <tr>
      <th>Item</th>
      <th>Available Qty</th>
      <th>Sell Qty</th>
      <th>Buyer Name</th>
      <th>Amount (‚Çπ)</th>
    </tr>
  </thead>
  <tbody></tbody>
  <tfoot>
    <tr style="font-weight:bold;background:#f0f0f0;">
      <td colspan="4">Total Sale (‚Çπ)</td>
      <td id="totalSale">0</td>
    </tr>
  </tfoot>
</table>

<div class="sell-btn">
  <button onclick="sellAll()">‚úÖ Sell</button>
  <button onclick="undoLastSale()" style="margin-left:10px;background:#e74c3c;color:#fff;">
    ‚Ü©Ô∏è Undo Last Sale
  </button>
</div>

<div class="log">
  <h3>üßæ Purchase Log</h3>
  <ul id="purchaseLog"></ul>
</div>

</div>

<script>
  /* üîê PASSWORD */
  const SITE_PASSWORD = "snack_attack";

  if (sessionStorage.getItem("loggedIn") === "true") showApp();

  function checkPassword() {
    const input = document.getElementById("passwordInput").value;
    if (input === SITE_PASSWORD) {
      sessionStorage.setItem("loggedIn", "true");
      showApp();
    } else {
      document.getElementById("error").textContent = "Wrong password!";
    }
  }

  function showApp() {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("app").style.display = "block";
  }

  /* üß† DATA */
  const DEFAULT_ITEMS = [
    { name: "Tedhe Medhe", qty: 21 },
    { name: "Mad Angles", qty: 3 },
    { name: "Kurkure Puffcorn", qty: 5 },
    { name: "Uncle Chips (Blue)", qty: 5 },
    { name: "Uncle Chips (Green)", qty: 7 },
    { name: "Bingo Salsa Dip", qty: 5 },
    { name: "Blue Lays", qty: 5 },
    { name: "Green Lays", qty: 3 },
    { name: "Diet Coke", qty: 5 }
  ];

  let items = JSON.parse(localStorage.getItem("items")) || structuredClone(DEFAULT_ITEMS);
  let logs = JSON.parse(localStorage.getItem("logs")) || [];
  let totalSale = Number(localStorage.getItem("totalSale")) || 0;

  const tableBody = document.querySelector("#inventoryTable tbody");
  const logList = document.getElementById("purchaseLog");
  const totalSaleEl = document.getElementById("totalSale");

  function saveData() {
    localStorage.setItem("items", JSON.stringify(items));
    localStorage.setItem("logs", JSON.stringify(logs));
    localStorage.setItem("totalSale", totalSale);
  }

  function renderTable() {
    tableBody.innerHTML = "";
    items.forEach((item, index) => {
      tableBody.innerHTML += `
        <tr>
          <td>${item.name}</td>
          <td>${item.qty}</td>
          <td><input type="number" min="0" id="qty-${index}"></td>
          <td><input type="text" id="buyer-${index}"></td>
          <td><input type="number" min="0" id="amount-${index}"></td>
        </tr>
      `;
    });
  }

  function renderLogs() {
    logList.innerHTML = "";
    logs.forEach(l => {
      const li = document.createElement("li");
      li.textContent = `${l.buyer} bought ${l.qty} √ó ${l.item} for ‚Çπ${l.amount} on ${l.date}`;
      logList.appendChild(li);
    });
    totalSaleEl.textContent = totalSale;
  }

  function sellAll() {
    items.forEach((item, index) => {
      const qty = Number(document.getElementById(`qty-${index}`).value);
      const buyer = document.getElementById(`buyer-${index}`).value.trim();
      const amount = Number(document.getElementById(`amount-${index}`).value);

      if (qty > 0) {
        if (!buyer || amount <= 0 || qty > item.qty) return alert("Invalid entry");

        item.qty -= qty;
        totalSale += amount;

        logs.push({
          item: item.name,
          qty,
          buyer,
          amount,
          date: new Date().toLocaleString()
        });
      }
    });

    saveData();
    renderAll();
  }

  function undoLastSale() {
    if (!logs.length) return alert("No sale to undo");

    const last = logs.pop();
    items.find(i => i.name === last.item).qty += last.qty;
    totalSale -= last.amount;

    saveData();
    renderAll();
  }

  function renderAll() {
    renderTable();
    renderLogs();
  }

  renderAll();
</script>

</body>
</html>
