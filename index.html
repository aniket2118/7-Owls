<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Snack Inventory System</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; padding:20px; }
    h1 { text-align:center; }
    table { width:100%; border-collapse: collapse; margin-top:20px; background:#fff; }
    th, td { border:1px solid #ccc; padding:10px; text-align:center; }
    th { background:#222; color:#fff; }
    input { width:90px; padding:5px; }
    button { padding:10px 20px; cursor:pointer; font-size:16px; }
    .log { margin-top:30px; background:#fff; padding:15px; }
    .sell-btn { margin-top:20px; text-align:center; }
  </style>
</head>
<body>

<h1>ðŸ›’ Snack Inventory & Sales</h1>

<table id="inventoryTable">
  <thead>
    <tr>
      <th>Item</th>
      <th>Available Qty</th>
      <th>Sell Qty</th>
      <th>Buyer Name</th>
      <th>Amount (â‚¹)</th>
    </tr>
  </thead>
  <tbody></tbody>
  <tfoot>
    <tr style="font-weight:bold;background:#f0f0f0;">
      <td colspan="4">Total Sale (â‚¹)</td>
      <td id="totalSale">0</td>
    </tr>
  </tfoot>
</table>

<div class="sell-btn">
  <button onclick="sellAll()">âœ… Sell</button>
</div>

<div class="log">
  <h3>ðŸ§¾ Purchase Log</h3>
  <ul id="purchaseLog"></ul>
</div>

<script>
  const DEFAULT_ITEMS = [
    { name: "Tedhe Medhe", qty: 21 },
    { name: "Mad Angles", qty: 3 },
    { name: "Kurkure Puffcorn", qty: 5 },
    { name: "Uncle Chips (Blue)", qty: 5 },
    { name: "Uncle Chips (Green)", qty: 7 },
    { name: "Bingo Salsa Dip", qty: 5 },
    { name: "Blue Lays", qty: 5 },
    { name: "Green Lays", qty: 3 },
    { name: "Diet Coke", qty: 5 }
  ];

  // LOAD FROM localStorage OR DEFAULT
  let items = JSON.parse(localStorage.getItem("items")) || DEFAULT_ITEMS;
  let totalSale = parseFloat(localStorage.getItem("totalSale")) || 0;
  let logs = JSON.parse(localStorage.getItem("logs")) || [];

  const tableBody = document.querySelector("#inventoryTable tbody");
  const log = document.getElementById("purchaseLog");
  const totalSaleEl = document.getElementById("totalSale");

  function saveData() {
    localStorage.setItem("items", JSON.stringify(items));
    localStorage.setItem("totalSale", totalSale);
    localStorage.setItem("logs", JSON.stringify(logs));
  }

  function renderTable() {
    tableBody.innerHTML = "";
    items.forEach((item, index) => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${item.name}</td>
        <td>${item.qty}</td>
        <td><input type="number" min="0" id="qty-${index}" /></td>
        <td><input type="text" id="buyer-${index}" /></td>
        <td><input type="number" min="0" id="amount-${index}" /></td>
      `;
      tableBody.appendChild(row);
    });
  }

  function renderLogs() {
    log.innerHTML = "";
    logs.forEach(text => {
      const li = document.createElement("li");
      li.textContent = text;
      log.appendChild(li);
    });
  }

  function sellAll() {
    let sessionTotal = 0;

    items.forEach((item, index) => {
      const sellQty = parseInt(document.getElementById(`qty-${index}`).value);
      const buyer = document.getElementById(`buyer-${index}`).value.trim();
      const amount = parseFloat(document.getElementById(`amount-${index}`).value);

      if (Number.isInteger(sellQty) && sellQty > 0) {
        if (!buyer || amount <= 0) {
          alert(`Missing buyer or amount for ${item.name}`);
          return;
        }
        if (sellQty > item.qty) {
          alert(`Not enough stock for ${item.name}`);
          return;
        }

        item.qty -= sellQty;
        sessionTotal += amount;

        const entry = `${buyer} bought ${sellQty} Ã— ${item.name} for â‚¹${amount} on ${new Date().toLocaleString()}`;
        logs.push(entry);
      }
    });

    if (sessionTotal > 0) {
      totalSale += sessionTotal;
      saveData();
      renderAll();
    }
  }

  function renderAll() {
    renderTable();
    renderLogs();
    totalSaleEl.textContent = totalSale;
  }

  renderAll();
</script>

</body>
</html>
